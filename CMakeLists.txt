## Public Domain
cmake_minimum_required (VERSION 2.8.11)
list(APPEND CMAKE_MODULE_PATH "${CMAKE_SOURCE_DIR}/cmake")

project (skunkworks)
    ## Compiler-specific C++11 activation/checks.
    if (${CMAKE_CXX_COMPILER_ID} MATCHES "GNU")
        if (NOT (CMAKE_CXX_COMPILER_VERSION VERSION_GREATER 4.8 OR CMAKE_CXX_COMPILER_VERSION VERSION_EQUAL 4.8))
            message(FATAL_ERROR "${PROJECT_NAME} requires g++ 4.8 or greater.")
        endif ()
        set(CMAKE_CXX_FLAGS                "-Wall -Wextra -Wno-unused -Wno-unused-parameter -std=c++1y -pedantic")
        set(CMAKE_CXX_FLAGS_DEBUG          "-O0 -g")
        set(CMAKE_CXX_FLAGS_MINSIZEREL     "-Os -DNDEBUG")
        set(CMAKE_CXX_FLAGS_RELEASE        "-O4 -DNDEBUG")
        set(CMAKE_CXX_FLAGS_RELWITHDEBINFO "-O2 -g")
        set(CMAKE_C_FLAGS                "-Wall -Wextra -Wno-unused -Wno-unused-parameter -std=gnu99  -pedantic")
        set(CMAKE_C_FLAGS_DEBUG          ${CMAKE_CXX_FLAGS_DEBUG})
        set(CMAKE_C_FLAGS_MINSIZEREL     ${CMAKE_CXX_FLAGS_MINSIZEREL})
        set(CMAKE_C_FLAGS_RELEASE        ${CMAKE_CXX_FLAGS_RELEASE})
        set(CMAKE_C_FLAGS_RELWITHDEBINFO ${CMAKE_CXX_FLAGS_RELWITHDEBINFO})
    elseif (${CMAKE_CXX_COMPILER_ID} MATCHES "Clang")
        if (NOT (CMAKE_CXX_COMPILER_VERSION VERSION_GREATER 3.3 OR CMAKE_CXX_COMPILER_VERSION VERSION_EQUAL 3.3))
            message(FATAL_ERROR "${PROJECT_NAME} requires clang 3.3 or greater.")
        endif ()
        set(CMAKE_CXX_FLAGS                "-Wall -Wextra -Wno-unused -Wno-unused-parameter -std=c++1y -pedantic")
        set(CMAKE_CXX_FLAGS_DEBUG          "-O0 -g")
        set(CMAKE_CXX_FLAGS_MINSIZEREL     "-Os -DNDEBUG")
        set(CMAKE_CXX_FLAGS_RELEASE        "-O4 -DNDEBUG")
        set(CMAKE_CXX_FLAGS_RELWITHDEBINFO "-O2 -g")
        set(CMAKE_C_FLAGS                "-Wall -Wextra -Wno-unused -Wno-unused-parameter -std=gnu99  -pedantic")
        set(CMAKE_C_FLAGS_DEBUG          ${CMAKE_CXX_FLAGS_DEBUG})
        set(CMAKE_C_FLAGS_MINSIZEREL     ${CMAKE_CXX_FLAGS_MINSIZEREL})
        set(CMAKE_C_FLAGS_RELEASE        ${CMAKE_CXX_FLAGS_RELEASE})
        set(CMAKE_C_FLAGS_RELWITHDEBINFO ${CMAKE_CXX_FLAGS_RELWITHDEBINFO})
        add_definitions(-D_GLIBCXX_USE_CLOCK_REALTIME)
        add_definitions(-D_GLIBCXX_USE_SCHED_YIELD)
    elseif (${CMAKE_CXX_COMPILER_ID} EQUAL "MSVC")
        ## /wd4251 silences warnings in OGRE headers
        set(CMAKE_CXX_FLAGS                "/EHsc /wd4251 /D_CRT_SECURE_NO_WARNINGS")
        ##set(CMAKE_CXX_FLAGS_DEBUG          "")
        ##set(CMAKE_CXX_FLAGS_MINSIZEREL     "")
        ##set(CMAKE_CXX_FLAGS_RELEASE        "")
        ##set(CMAKE_CXX_FLAGS_RELWITHDEBINFO "")
        if (NOT (CMAKE_CXX_COMPILER_VERSION VERSION_GREATER 18.0 OR CMAKE_CXX_COMPILER_VERSION VERSION_EQUAL 18.0))
            message(FATAL_ERROR "${PROJECT_NAME} requires vs2013 or greater.")
        endif ()
    elseif (${CMAKE_CXX_COMPILER_ID} MATCHES "Intel")
        set(CMAKE_CXX_FLAGS                "-Wall -Wextra -Wno-unused -Wno-unused-parameter -std=c++11 -pedantic")
        set(CMAKE_CXX_FLAGS_DEBUG          "-O0 -g")
        set(CMAKE_CXX_FLAGS_MINSIZEREL     "-Os -DNDEBUG")
        set(CMAKE_CXX_FLAGS_RELEASE        "-O4 -DNDEBUG")
        set(CMAKE_CXX_FLAGS_RELWITHDEBINFO "-O2 -g")
        set(CMAKE_C_FLAGS                "-Wall -Wextra -Wno-unused -Wno-unused-parameter -std=gnu99  -pedantic")
        set(CMAKE_C_FLAGS_DEBUG          ${CMAKE_CXX_FLAGS_DEBUG})
        set(CMAKE_C_FLAGS_MINSIZEREL     ${CMAKE_CXX_FLAGS_MINSIZEREL})
        set(CMAKE_C_FLAGS_RELEASE        ${CMAKE_CXX_FLAGS_RELEASE})
        set(CMAKE_C_FLAGS_RELWITHDEBINFO ${CMAKE_CXX_FLAGS_RELWITHDEBINFO})
        if (NOT (CMAKE_CXX_COMPILER_VERSION VERSION_GREATER 13.0 OR CMAKE_CXX_COMPILER_VERSION VERSION_EQUAL 13.0))
            message(FATAL_ERROR "${PROJECT_NAME} requires icc 13 or greater.")
        endif ()
    else ()
        message(FATAL_ERROR "Your C++ compiler does not have the required compiler support.")
    endif ()
    
    ## CMake defaults to leaving CMAKE_BUILD_TYPE empty. 
    ## This screws updifferentiation between debug and release builds.   
    if (CMAKE_BUILD_TYPE STREQUAL "")
      set(CMAKE_BUILD_TYPE "Debug" CACHE STRING "Choose the type of build, options are: None (CMAKE_CXX_FLAGS or CMAKE_C_FLAGS used) Debug Release RelWithDebInfo MinSizeRel." FORCE)
    endif ()
    
    set(USE_SDL2 FALSE CACHE BOOL "Use SDL for window creation and ois input subsystem?")
    
    if(CMAKE_INSTALL_PREFIX_INITIALIZED_TO_DEFAULT)
    set(CMAKE_INSTALL_PREFIX "${CMAKE_SOURCE_DIR}/../binaries" CACHE PATH "install prefix" FORCE)
    endif(CMAKE_INSTALL_PREFIX_INITIALIZED_TO_DEFAULT)
    
    add_subdirectory(base)
    add_subdirectory(external)
    add_subdirectory(framework)
    add_subdirectory(plugins)
    
    find_package(ZMQ REQUIRED)
    list(APPEND SKUNKWORKS_LIBRARIES ${ZMQ_LIBRARY})   
    list(APPEND SKUNKWORKS_INCLUDE_DIRS ${ZMQ_INCLUDE_DIR})
    
    list(APPEND SKUNKWORKS_LIBRARIES Framework)    
    list(APPEND SKUNKWORKS_SOURCE ${CMAKE_SOURCE_DIR}/main.cpp)
    list(APPEND SKUNKWORKS_INCLUDE_DIRS ${CMAKE_SOURCE_DIR})

    include_directories(${SKUNKWORKS_INCLUDE_DIRS} )
    add_executable(Skunkworks ${SKUNKWORKS_SOURCE})
    target_link_libraries(Skunkworks ${SKUNKWORKS_LIBRARIES})
    
    install (TARGETS Skunkworks 
        DESTINATION ${CMAKE_INSTALL_PREFIX}/release
        CONFIGURATIONS Release RelWithDebInfo)
    install (TARGETS Skunkworks
        DESTINATION ${CMAKE_INSTALL_PREFIX}/debug
        CONFIGURATIONS Debug)

